---
id: ARCH-module-c2-control
title: "Модуль: Управління C2 (Командування та Контроль)"
type: module
layer: application
owner: "@AI-DocArchitect"
version: v1
status: current
created: 2025-06-02
updated: 2025-06-02
tags: [backend, c2, command_and_control, implant, beacon, tasking, dns_c2]
depends_on:
  - ARCH-config
referenced_by: []
---
## Контекст
Модуль C2 (Командування та Контроль) є ключовим компонентом backend, що відповідає за симуляцію взаємодії з імплантами. Він обробляє "маячки" від імплантів, дозволяє ставити їм завдання, отримувати результати виконання, керувати списком симульованих імплантів та підтримує концептуальну симуляцію DNS C2.

## Структура
Основні файли модуля:
- `CYBER_DASHBOARD_BACKEND/c2_control/logic.py`: Містить всю основну логіку C2.
    - Глобальні змінні стану: `simulated_implants_c2`, `pending_tasks_for_implants_c2`, `exfiltrated_file_chunks_db_c2`.
    - `initialize_simulated_implants_c2_logic()`: Ініціалізує список симульованих імплантів при старті.
    - `handle_c2_beacon_logic()`: Обробляє HTTP-маячки від імплантів, оновлює їх статус, видає завдання з черги, обробляє результати попередніх завдань та частини ексфільтрованих файлів.
    - `handle_dns_resolver_sim_logic()`: Симулює DNS-резолвер для DNS C2, дозволяючи імплантам отримувати завдання через DNS-запити (концептуально).
    - `get_c2_implants_logic()`: Повертає поточний список симульованих імплантів з оновленими статусами (наприклад, `offline_timeout`).
    - `handle_c2_task_logic()`: Додає нове завдання до черги для вказаного імпланта.
    - `get_simulated_implants()`, `get_exfiltrated_file_chunks()`: Допоміжні функції для доступу до стану C2 (використовуються, наприклад, модулем `operational_data`).
- `CYBER_DASHBOARD_BACKEND/c2_control/routes.py`: Визначає HTTP ендпоінти для взаємодії з логікою C2.
    - `/api/c2/beacon_receiver` (POST): Для прийому маячків.
    - `/api/c2/dns_resolver_sim` (GET): Для симуляції DNS C2.
    - `/api/c2/implants` (GET): Для отримання списку імплантів.
    - `/api/c2/task` (POST): Для постановки завдань.
- `CYBER_DASHBOARD_BACKEND/c2_control/__init__.py`: Ініціалізаційний файл модуля.

Використовує `config.py` для доступу до `VERSION_BACKEND`.

## Поведінка
1.  **Ініціалізація**: При завантаженні модуля `logic.py` автоматично викликається `initialize_simulated_implants_c2_logic()`, що створює початковий набір симульованих імплантів.
2.  **Маячки (Beaconing)**:
    - Імпланти (симульовані або реальні, що взаємодіють зі стейджером `demo_c2_beacon_payload`) надсилають POST-запити на `/api/c2/beacon_receiver`.
    - `handle_c2_beacon_logic` оновлює час останнього контакту імпланта, його IP-адресу, статус.
    - Якщо імплант передає результати попереднього завдання або частини файлу для ексфільтрації, ця інформація обробляється.
    - Якщо для імпланта є завдання в черзі (`pending_tasks_for_implants_c2`), наступне завдання видається у відповіді.
3.  **Постановка Завдань**:
    - Користувач через frontend (або напряму через API) надсилає POST-запит на `/api/c2/task` з ID імпланта, типом завдання та параметрами.
    - `handle_c2_task_logic` додає це завдання до черги відповідного імпланта.
4.  **DNS C2 (Симуляція)**:
    - Імплант (симульований або реальний, що взаємодіє зі стейджером `dns_beacon_c2_concept`) робить DNS-запит, який (концептуально) перенаправляється на GET `/api/c2/dns_resolver_sim`.
    - `handle_dns_resolver_sim_logic` перевіряє наявність завдань для цього імпланта та може повернути їх у вигляді Base64-кодованого JSON (імітуючи відповідь у TXT-записі DNS).
5.  **Отримання Списку Імплантів**:
    - GET-запит на `/api/c2/implants` викликає `get_c2_implants_logic`, яка повертає актуальний список імплантів та їхній стан.

## Еволюція
### Заплановано
- Розширення типів завдань, що підтримуються.
- Більш реалістична симуляція поведінки імплантів.
- Можлива інтеграція з реальною базою даних для зберігання стану C2.
### Історичне
- v1: Реалізація основного функціоналу C2: управління імплантами, маячки, постановка завдань, ексфільтрація файлів (концепт), DNS C2 (концепт). Стан зберігається в пам'яті. 